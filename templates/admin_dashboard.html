{% extends "admin_base.html" %}
{% block title %}Dashboard Admin{% endblock %}
{% block content2 %}
<h1 class="text-center text-white mb-4">Tableau de Bord Administratif</h1>
<div class="row">
    <!-- Statistiques principales -->
    <div class="col-md-3 mb-4">
        <div class="card bg-info text-white text-center shadow">
            <div class="card-body">
                <h5 class="card-title">Employés</h5>
                <p class="card-text display-4">{{ total_employes }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card bg-success text-white text-center shadow">
            <div class="card-body">
                <h5 class="card-title">Départements</h5>
                <p class="card-text display-4">{{ total_departements }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card bg-warning text-white text-center shadow">
            <div class="card-body">
                <h5 class="card-title">Congés Acceptés</h5>
                <p class="card-text display-4">{{ conges_acceptes }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card bg-danger text-white text-center shadow">
            <div class="card-body">
                <h5 class="card-title">Salaire Moyen</h5>
                <p class="card-text display-4">{{ salaire_moyen }} €</p>
            </div>
        </div>
    </div>
</div>

<!-- Graphiques -->
<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="card bg-light shadow">
            <div class="card-body">
                <h5 class="card-title">Congés Acceptés</h5>
                <div class="d-flex justify-content-end mb-2">
                    <button id="btnJour" class="btn btn-outline-primary btn-sm mx-1">Par Jour</button>
                    <button id="btnMois" class="btn btn-outline-primary btn-sm">Par Mois</button>
                </div>
                <canvas id="chartConges"></canvas>
            </div>
        </div>
        <div class="col-lg-6 mb-4" style="width: 100%;">
            <div class="card bg-light shadow">
                <div class="card-body">
                    <h5 class="card-title">Statistiques du Jour</h5>
                    <p><strong>Personnes sur site aujourd'hui :</strong> {{ personnes_sur_site }}</p>
                    <p><strong>Personnes en télétravail aujourd'hui :</strong> {{ personnes_teletravail }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6 mb-4">
        <div class="card bg-light shadow">
            <div class="card-body">
                <h5 class="card-title">Employés par Département</h5>
                <canvas id="chartDepartements"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content3 %}
    <script>
        // Données pour les congés par mois
    const joursLabels = {{ jours_labels | tojson }};
    const congesParJour = {{ conges_par_jour | tojson }};
    const moisLabels = {{ mois_labels | tojson }};
    const congesParMois = {{ conges_par_mois | tojson }};

    const chartCongesCtx = document.getElementById('chartConges').getContext('2d');
    let currentChart;

    function createChart(labels, data, label) {
        if (currentChart) {
            currentChart.destroy();
        }
        currentChart = new Chart(chartCongesCtx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: label,
                    data: data,
                    backgroundColor: 'rgba(75, 192, 192, 0.5)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    // Par défaut, afficher les congés par mois
    createChart(moisLabels, congesParMois, 'Congés Acceptés par Mois');

    document.getElementById('btnJour').addEventListener('click', () => {
        createChart(joursLabels, congesParJour, 'Congés Acceptés par Jour');
    });

    document.getElementById('btnMois').addEventListener('click', () => {
        createChart(moisLabels, congesParMois, 'Congés Acceptés par Mois');
    });

        // Données pour les employés par département
        const departementLabels = {{ departement_labels | tojson }};
        const employesParDepartement = {{ employes_par_departement | tojson }};

        const chartDepartementsCtx = document.getElementById('chartDepartements').getContext('2d');
        new Chart(chartDepartementsCtx, {
            type: 'pie',
            data: {
                labels: departementLabels,
                datasets: [{
                    label: 'Employés',
                    data: employesParDepartement,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 206, 86, 0.5)',
                        'rgba(75, 192, 192, 0.5)',
                        'rgba(153, 102, 255, 0.5)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    </script>
{% endblock %}
