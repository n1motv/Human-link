<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord Administrateur</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>Mon Application</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="{{ url_for('ajouter_employe_page') }}">Ajouter un employé</a></li>
                    <li><a href="{{ url_for('calendrier_conges') }}">Calendrier Congés</a></li>
                    <li><a href="{{ url_for('assigner_manager') }}">Assigner Manager</a></li>
                    <li><a href="{{ url_for('demandes_conges') }}">Demandes de congés</a></li>
                    <li><a href="{{ url_for('logout') }}">Se déconnecter</a></li>
                    <style>
                        
                            
                    </style>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <h2>Bienvenue Administrateur</h2>

            <h3>Liste des employés</h3>
            <table>
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>Âge</th>
                        <th>Poste</th>
                        <th>Département</th>
                        <th>Email</th>
                        <th>Congé</th>
                        <th>Salaire</th>
                        <th>role</th>
                        <th>Actions</th>
                        
                    </tr>
                </thead>
                <tbody>
                    {% for emp in employees %}
                    <tr>
                        <td>{{ emp[0] }}</td>
                        <td>{{ emp[1] }}</td>
                        <td>{{ emp[2] }}</td>
                        <td>{{ emp[3] }}</td>
                        <td>{{ emp[4] }}</td>
                        <td>{{ emp[5] }}</td>
                        <td>{{ emp[6] }}</td>
                        <td>{{ emp[7] }}</td>
                        <td>{{ emp[9] }}</td>
                        <td>
                            <!-- Bouton Modifier avec confirmation -->
                            <button class="btn btn-warning" style = "background-color: #4a5b6b; color: white; width: 90%;" onclick="confirmModification({{ emp[8] }})" id="modifierBtn{{ emp[8] }}">Modifier</button>

                            <!-- Formulaire de modification caché -->
                            <form id="formModifier{{ emp[8] }}" action="{{ url_for('mettre_a_jour_employe', id=emp[8]) }}" method="POST" style="display:none;">
                                <input type="text" name="nom" value="{{ emp[0] }}" id="nom{{ emp[8] }}">
                                <input type="text" name="prenom" value="{{ emp[1] }}" id="prenom{{ emp[8] }}">
                                <input type="number" name="age" value="{{ emp[2] }}" id="age{{ emp[8] }}">
                                <input type="text" name="poste" value="{{ emp[3] }}" id="poste{{ emp[8] }}">
                                <input type="text" name="email" value="{{ emp[5] }}" id="email{{ emp[8] }}">
                                <input type="number" name="salaire" value="{{ emp[7] }}" id="salaire{{ emp[8] }}">
                                
                                <!-- Champ de modification du mot de passe -->
                                <input type="password" name="mot_de_passe" placeholder="Nouveau mot de passe (laisser vide pour ne pas changer)" id="mot_de_passe{{ emp[8] }}" required minlength="8">
                            
                                <!-- Champ de congés si nécessaire -->
                                <input type="number" name="conge" value="{{ emp[6] }}" id="conge{{ emp[8] }}" placeholder="Nombre de jours de congé">
                            
                                <button type="submit" class="btn btn-success" style = "width: 90%;" >Appliquer</button>
                            </form>
                            

                            <!-- Bouton Supprimer -->
                            <form action="{{ url_for('supprimer_employe', id=emp[8]) }}" method="POST" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet employé ?');">
                                <button type="submit" style = "width: 90%;" class="btn btn-danger">Supprimer</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>

    <script>
        // Fonction de confirmation avant modification
        function confirmModification(empId) {
            // Demander une confirmation avant de passer en mode édition
            if (confirm("Voulez-vous modifier les informations de cet employé ?")) {
                // Masquer le bouton Modifier
                document.getElementById("modifierBtn" + empId).style.display = 'none';
                // Afficher le formulaire de modification
                document.getElementById("formModifier" + empId).style.display = 'block';
    
                // Changer le texte du bouton à "Appliquer"
                let btn = document.getElementById("modifierBtn" + empId);
                btn.innerHTML = "Appliquer";
                btn.classList.remove("btn-warning");
                btn.classList.add("btn-success");
    
                // Ajouter un nouvel événement pour soumettre les modifications
                btn.setAttribute("onclick", "submitModification(" + empId + ")");
            }
        }
    
        // Fonction pour soumettre les modifications après confirmation
        function submitModification(empId) {
            let form = document.getElementById("formModifier" + empId);
            form.submit();
        }
    </script>
    
    <footer>
        <p>&copy; 2024 Gestionnaire RH. Tous droits réservés.</p>
    </footer>
</body>
</html>
